---
layout: single
title: Dynamic Models
date:   2017-12-03 17:19:31 +0100
categories: [control, model, dynamic]
tags: [udacity, model, dynamic, mpc]
use_math: true
toc: true
# toc_label: "Unscented Kalman Filter"
image:
  feature: /assets/posts/2017-12-03-dynamic-models/lat-lon-forces.png
  thumb: /assets/posts/2017-12-03-dynamic-models/lat-lon-forces.png #keep it square 200x200 px is good
---


Dynamic models aim to embody the actual vehicle dynamics as closely as possible.
They might encompass tire forces, longitudinal and lateral forces, inertia, gravity, air resistance, drag, mass, and the geometry of the vehicle.
Not all dynamic models are created equal! Some may consider more of these factors than others.
Advanced dynamic models even take internal vehicle forces into account - for example, how responsive the chassis suspension is.

## Forces

{% include figure image_path="/assets/posts/2017-12-03-dynamic-models/lat-lon-forces.png" caption="Laterl and longitudinal forces (Source: [Udacity self driving car ND](https://classroom.udacity.com/nanodegrees/nd013/parts/40f38239-66b6-46ec-ae68-03afd8a601c8/modules/f1820894-8322-4bb3-81aa-b26b3c6dcbaf/lessons/af4fcd4f-eb1f-43d8-82b3-17bb1e71695f/concepts/3a3daa28-e70b-4515-abae-27c84367ac1b))" %}

The vehicle dynamics models -- the complex interactions between the tires and the road -- determine the motion of the vehicle.
While there are many forces to consider in a dynamic model, they essentially boil down to longitudinal and lateral forces acting on the vehicle.
Think of the longitudinal force as a force pushing the vehicle forward or backward and lateral force is a force pushing the vehicle side to side.


{% include figure image_path="/assets/posts/2017-12-03-dynamic-models/tire-forces.png" caption="Tire forces (Source: [Udacity self driving car ND](https://classroom.udacity.com/nanodegrees/nd013/parts/40f38239-66b6-46ec-ae68-03afd8a601c8/modules/f1820894-8322-4bb3-81aa-b26b3c6dcbaf/lessons/af4fcd4f-eb1f-43d8-82b3-17bb1e71695f/concepts/3a3daa28-e70b-4515-abae-27c84367ac1b))" %}

The longitudinal and lateral force on the vehicle is the sum of the forces on the tires.


## Slip angle


The slip angle can be interpreted as the angle between the velocity vector of the wheel and the orientation of the wheel itself.
The slip angle can be expressed as the arc tangent of the wheel lateral velocity divided by the wheel longitudinal velocity.

{% include figure image_path="/assets/posts/2017-12-03-dynamic-models/slip-angle.png" caption="Slip angle (Source: [Udacity self driving car ND](https://classroom.udacity.com/nanodegrees/nd013/parts/40f38239-66b6-46ec-ae68-03afd8a601c8/modules/f1820894-8322-4bb3-81aa-b26b3c6dcbaf/lessons/af4fcd4f-eb1f-43d8-82b3-17bb1e71695f/concepts/e6511d73-cda0-4ee9-b94b-c0ccd02439ef))" %}

The force generated by the slip angle is actually how a vehicle turns. Otherwise, inertia would carry the vehicle off the road.
Different tires have different characteristics though. Racing tires generate much more force from the same slip angle than conventional tires.

## Slip ratio

The slip ratio comes up when there's a mismatch between the speed of the vehicle wheel and the expected longitudinal velocity.
This means, in addition to the tire's natural rolling motion, there's also a slipping motion.

{% include figure image_path="/assets/posts/2017-12-03-dynamic-models/slip-ratio-def.png" caption="Slip ratio definition (Source: [Udacity self driving car ND](https://classroom.udacity.com/nanodegrees/nd013/parts/40f38239-66b6-46ec-ae68-03afd8a601c8/modules/f1820894-8322-4bb3-81aa-b26b3c6dcbaf/lessons/af4fcd4f-eb1f-43d8-82b3-17bb1e71695f/concepts/a0a2df4e-3c57-4297-a104-f7b069868062))" %}

Similarly to how the slip angle's required to generate lateral force, the slip ratio is required to generate longitudinal force.
In either case, all of this begins when the contact patch of the tire meets the road.

{% include figure image_path="/assets/posts/2017-12-03-dynamic-models/slip-ratio.png" caption="Slip ratio (Source: [Udacity self driving car ND](https://classroom.udacity.com/nanodegrees/nd013/parts/40f38239-66b6-46ec-ae68-03afd8a601c8/modules/f1820894-8322-4bb3-81aa-b26b3c6dcbaf/lessons/af4fcd4f-eb1f-43d8-82b3-17bb1e71695f/concepts/a0a2df4e-3c57-4297-a104-f7b069868062))" %}

## Tire Models

Tire models aim to model the behavior of the tire as closely as possible. For example, the lateral force generated looks something like
this:

{% include figure image_path="/assets/posts/2017-12-03-dynamic-models/tire-model.png" caption="Tire model (Source: [Udacity self driving car ND](https://classroom.udacity.com/nanodegrees/nd013/parts/40f38239-66b6-46ec-ae68-03afd8a601c8/modules/f1820894-8322-4bb3-81aa-b26b3c6dcbaf/lessons/af4fcd4f-eb1f-43d8-82b3-17bb1e71695f/concepts/462c08ed-de0e-4f49-acca-cdf5e44a997a))" %}

alpha is this slip angle and F is a lateral force. Race car drivers have a fantastic mental model of this graph and can
usually capture optimal longitudinal or lateral force for the situation.

The slip angle is just one component used to calculate the longitudinal and lateral forces of tires.
There is a breadth of literature dedicated to the study of tire dynamics.
The most popular model is the Pacejka tire model, also known as the Magic Tire Formula.


## Additional reading

- [Pacejka Tire Model](http://www.theoryinpracticeengineering.com/resources/tires/pacejka87.pdf)
- [This paper](http://www.me.berkeley.edu/~frborrel/pdfpub/IV_KinematicMPC_jason.pdf) presents a comparison between a kinematic and dynamic model.
